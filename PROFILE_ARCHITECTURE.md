# Profile System Architecture

## ğŸ—ï¸ System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FRONTEND (React)                        â”‚
â”‚                   http://localhost:3000                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚           Profile.jsx Component                     â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚                                                     â”‚     â”‚
â”‚  â”‚  State:                                             â”‚     â”‚
â”‚  â”‚  â€¢ user (profile data)                              â”‚     â”‚
â”‚  â”‚  â€¢ reports (hazards list)                           â”‚     â”‚
â”‚  â”‚  â€¢ stats (counts)                                   â”‚     â”‚
â”‚  â”‚  â€¢ loading (boolean)                                â”‚     â”‚
â”‚  â”‚  â€¢ isEditing (boolean)                              â”‚     â”‚
â”‚  â”‚  â€¢ uploadingPhoto (boolean)                         â”‚     â”‚
â”‚  â”‚  â€¢ formData (edit form)                             â”‚     â”‚
â”‚  â”‚                                                     â”‚     â”‚
â”‚  â”‚  Functions:                                         â”‚     â”‚
â”‚  â”‚  â€¢ fetchUserProfile()                               â”‚     â”‚
â”‚  â”‚  â€¢ fetchUserHazards()                               â”‚     â”‚
â”‚  â”‚  â€¢ handlePhotoUpload()                              â”‚     â”‚
â”‚  â”‚  â€¢ handleDeletePhoto()                              â”‚     â”‚
â”‚  â”‚  â€¢ handleUpdateProfile()                            â”‚     â”‚
â”‚  â”‚                                                     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                          â”‚                                    â”‚
â”‚                          â”‚ HTTP Requests                      â”‚
â”‚                          â”‚ (Authorization: Bearer token)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  BACKEND (Express.js)                        â”‚
â”‚                   http://localhost:5004                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚              API Routes Layer                       â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚                                                     â”‚     â”‚
â”‚  â”‚  /api/users/profile          [GET, PUT, DELETE]    â”‚     â”‚
â”‚  â”‚  /api/users/my-hazards       [GET]                 â”‚     â”‚
â”‚  â”‚  /api/users/preferences      [PATCH]               â”‚     â”‚
â”‚  â”‚  /api/upload/profile-photo   [POST, DELETE]        â”‚     â”‚
â”‚  â”‚                                                     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                          â”‚                                    â”‚
â”‚                          â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚           Middleware Layer                          â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚                                                     â”‚     â”‚
â”‚  â”‚  authMiddleware:                                    â”‚     â”‚
â”‚  â”‚  â€¢ Verify JWT token                                 â”‚     â”‚
â”‚  â”‚  â€¢ Decode user ID                                   â”‚     â”‚
â”‚  â”‚  â€¢ Attach req.user                                  â”‚     â”‚
â”‚  â”‚                                                     â”‚     â”‚
â”‚  â”‚  upload.profile:                                    â”‚     â”‚
â”‚  â”‚  â€¢ Validate file type (images only)                 â”‚     â”‚
â”‚  â”‚  â€¢ Check file size (< 2MB)                          â”‚     â”‚
â”‚  â”‚  â€¢ Generate unique filename                         â”‚     â”‚
â”‚  â”‚  â€¢ Save to uploads/profiles/                        â”‚     â”‚
â”‚  â”‚                                                     â”‚     â”‚
â”‚  â”‚  upload.hazard:                                     â”‚     â”‚
â”‚  â”‚  â€¢ Validate file type (images only)                 â”‚     â”‚
â”‚  â”‚  â€¢ Check file size (< 5MB)                          â”‚     â”‚
â”‚  â”‚  â€¢ Save to uploads/hazards/                         â”‚     â”‚
â”‚  â”‚                                                     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                          â”‚                                    â”‚
â”‚                          â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚           Controller Layer                          â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚                                                     â”‚     â”‚
â”‚  â”‚  userController:                                    â”‚     â”‚
â”‚  â”‚  â€¢ getUserProfile() â†’ Get user + stats              â”‚     â”‚
â”‚  â”‚  â€¢ updateUserProfile() â†’ Update name/email/pass     â”‚     â”‚
â”‚  â”‚  â€¢ getUserHazards() â†’ Get user's reports            â”‚     â”‚
â”‚  â”‚  â€¢ deleteUserAccount() â†’ Soft delete                â”‚     â”‚
â”‚  â”‚  â€¢ updateUserPreferences() â†’ Update settings        â”‚     â”‚
â”‚  â”‚                                                     â”‚     â”‚
â”‚  â”‚  uploadController:                                  â”‚     â”‚
â”‚  â”‚  â€¢ uploadProfilePhoto() â†’ Save photo + update DB    â”‚     â”‚
â”‚  â”‚  â€¢ deleteProfilePhoto() â†’ Delete file + update DB   â”‚     â”‚
â”‚  â”‚  â€¢ uploadHazardPhoto() â†’ Save hazard photo          â”‚     â”‚
â”‚  â”‚                                                     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                          â”‚                                    â”‚
â”‚                          â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚              Model Layer                            â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚                                                     â”‚     â”‚
â”‚  â”‚  User Model (Mongoose):                             â”‚     â”‚
â”‚  â”‚  â€¢ fullName: String                                 â”‚     â”‚
â”‚  â”‚  â€¢ email: String (unique)                           â”‚     â”‚
â”‚  â”‚  â€¢ password: String (hashed)                        â”‚     â”‚
â”‚  â”‚  â€¢ avatar: String (photo URL)                       â”‚     â”‚
â”‚  â”‚  â€¢ role: String                                     â”‚     â”‚
â”‚  â”‚  â€¢ isActive: Boolean                                â”‚     â”‚
â”‚  â”‚  â€¢ preferences: Object                              â”‚     â”‚
â”‚  â”‚  â€¢ createdAt: Date                                  â”‚     â”‚
â”‚  â”‚                                                     â”‚     â”‚
â”‚  â”‚  Hazard Model:                                      â”‚     â”‚
â”‚  â”‚  â€¢ hazardType: String                               â”‚     â”‚
â”‚  â”‚  â€¢ description: String                              â”‚     â”‚
â”‚  â”‚  â€¢ severity: String                                 â”‚     â”‚
â”‚  â”‚  â€¢ status: String                                   â”‚     â”‚
â”‚  â”‚  â€¢ location: Object                                 â”‚     â”‚
â”‚  â”‚  â€¢ photo: String                                    â”‚     â”‚
â”‚  â”‚  â€¢ reportedBy: ObjectId â†’ User                      â”‚     â”‚
â”‚  â”‚  â€¢ createdAt: Date                                  â”‚     â”‚
â”‚  â”‚                                                     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                          â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DATABASE (MongoDB Atlas)                   â”‚
â”‚         cluster0.ipuhunm.mongodb.net/saferoute              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Collections:                                                 â”‚
â”‚  â€¢ users                                                      â”‚
â”‚  â€¢ hazards                                                    â”‚
â”‚  â€¢ routes                                                     â”‚
â”‚  â€¢ aboutcontents                                              â”‚
â”‚  â€¢ teammembers                                                â”‚
â”‚  â€¢ faqs                                                       â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                           â–²
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   FILE SYSTEM (Local)                        â”‚
â”‚              e:\SafeRoute\backend\uploads\                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  profiles/                                                    â”‚
â”‚  â”œâ”€â”€ profile-userId1-1234567890.jpg                          â”‚
â”‚  â”œâ”€â”€ profile-userId2-1234567891.png                          â”‚
â”‚  â””â”€â”€ profile-userId3-1234567892.webp                         â”‚
â”‚                                                               â”‚
â”‚  hazards/                                                     â”‚
â”‚  â”œâ”€â”€ hazard-1234567890-abc123-photo.jpg                      â”‚
â”‚  â”œâ”€â”€ hazard-1234567891-def456-photo.png                      â”‚
â”‚  â””â”€â”€ hazard-1234567892-ghi789-photo.jpg                      â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Request Flow Examples

### Example 1: Upload Profile Photo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser   â”‚
â”‚  (Profile)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. User selects photo.jpg (1.5MB)
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  handlePhotoUpload() â”‚
â”‚                      â”‚
â”‚  Validates:          â”‚
â”‚  â€¢ File type? âœ… JPG â”‚
â”‚  â€¢ Size < 2MB? âœ…    â”‚
â”‚                      â”‚
â”‚  Creates FormData:   â”‚
â”‚  avatar = [File]     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 2. POST /api/upload/profile-photo
       â”‚    Authorization: Bearer eyJhbG...
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  authMiddleware      â”‚
â”‚                      â”‚
â”‚  â€¢ Verifies token âœ… â”‚
â”‚  â€¢ req.user.id set   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  upload.profile      â”‚
â”‚  (Multer)            â”‚
â”‚                      â”‚
â”‚  â€¢ Type check âœ…     â”‚
â”‚  â€¢ Size check âœ…     â”‚
â”‚  â€¢ Save to:          â”‚
â”‚    uploads/profiles/ â”‚
â”‚    profile-userId-   â”‚
â”‚    1730304000.jpg    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ uploadProfilePhoto() â”‚
â”‚                      â”‚
â”‚  1. Find user in DB  â”‚
â”‚  2. Delete old photo â”‚
â”‚     (if exists)      â”‚
â”‚  3. Update avatar:   â”‚
â”‚     "/uploads/       â”‚
â”‚      profiles/..."   â”‚
â”‚  4. Save to MongoDB  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 3. Response:
       â”‚    { success: true,
       â”‚      data: { url: "/uploads/..." } }
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser            â”‚
â”‚                      â”‚
â”‚  setUser({           â”‚
â”‚    ...user,          â”‚
â”‚    avatar: url       â”‚
â”‚  })                  â”‚
â”‚                      â”‚
â”‚  Photo appears! âœ…   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Example 2: Update Profile

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser   â”‚
â”‚  (Profile)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. User edits name & clicks Save
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚handleUpdateProfile() â”‚
â”‚                      â”‚
â”‚  Validates:          â”‚
â”‚  â€¢ Name length âœ…    â”‚
â”‚  â€¢ Email format âœ…   â”‚
â”‚  â€¢ Passwords match âœ…â”‚
â”‚                      â”‚
â”‚  Body:               â”‚
â”‚  {                   â”‚
â”‚    fullName: "...",  â”‚
â”‚    email: "...",     â”‚
â”‚    currentPassword,  â”‚
â”‚    newPassword       â”‚
â”‚  }                   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 2. PUT /api/users/profile
       â”‚    Authorization: Bearer token
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  authMiddleware      â”‚
â”‚                      â”‚
â”‚  â€¢ Verifies token âœ… â”‚
â”‚  â€¢ req.user.id set   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ updateUserProfile()  â”‚
â”‚                      â”‚
â”‚  1. Find user        â”‚
â”‚  2. Check email      â”‚
â”‚     uniqueness       â”‚
â”‚  3. Verify current   â”‚
â”‚     password         â”‚
â”‚  4. Hash new pass    â”‚
â”‚  5. Update fields    â”‚
â”‚  6. Save to MongoDB  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 3. Response:
       â”‚    { success: true,
       â”‚      data: { user: {...} } }
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser            â”‚
â”‚                      â”‚
â”‚  setUser(newUser)    â”‚
â”‚  setIsEditing(false) â”‚
â”‚                      â”‚
â”‚  Profile updated! âœ… â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Example 3: Get Profile Data

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser   â”‚
â”‚  (Profile)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. Page loads
       â”‚    useEffect()
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ fetchUserProfile()   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 2. GET /api/users/profile
       â”‚    Authorization: Bearer token
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  authMiddleware      â”‚
â”‚                      â”‚
â”‚  â€¢ Verifies token âœ… â”‚
â”‚  â€¢ req.user.id set   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  getUserProfile()    â”‚
â”‚                      â”‚
â”‚  1. Find user by ID  â”‚
â”‚  2. Count hazards:   â”‚
â”‚     â€¢ Total          â”‚
â”‚     â€¢ Verified       â”‚
â”‚  3. Count routes     â”‚
â”‚                      â”‚
â”‚  MongoDB Queries:    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  User.findById()     â”‚
â”‚  Hazard.count({      â”‚
â”‚    reportedBy: id,   â”‚
â”‚    status: ...       â”‚
â”‚  })                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 3. Response:
       â”‚    { success: true,
       â”‚      data: {
       â”‚        user: {...},
       â”‚        stats: {
       â”‚          totalReports: 15,
       â”‚          verifiedReports: 10,
       â”‚          totalRoutes: 5
       â”‚        }
       â”‚      }
       â”‚    }
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser            â”‚
â”‚                      â”‚
â”‚  setUser(user)       â”‚
â”‚  setStats(stats)     â”‚
â”‚  setLoading(false)   â”‚
â”‚                      â”‚
â”‚  Displays data! âœ…   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—‚ï¸ File Organization

```
SafeRoute/
â”‚
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ userController.js       â† Profile CRUD operations
â”‚   â”‚   â””â”€â”€ uploadController.js     â† Photo upload/delete âœ… NEW
â”‚   â”‚
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ auth.js                 â† JWT verification
â”‚   â”‚   â””â”€â”€ upload.js               â† Multer config âœ… UPDATED
â”‚   â”‚
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ User.js                 â† User schema with avatar
â”‚   â”‚   â””â”€â”€ Hazard.js               â† Hazard schema
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ users.js                â† /api/users/* routes
â”‚   â”‚   â””â”€â”€ upload.js               â† /api/upload/* routes âœ… UPDATED
â”‚   â”‚
â”‚   â”œâ”€â”€ uploads/
â”‚   â”‚   â”œâ”€â”€ profiles/               â† Profile photos âœ… NEW
â”‚   â”‚   â””â”€â”€ hazards/                â† Hazard photos
â”‚   â”‚
â”‚   â”œâ”€â”€ PROFILE_API.md              â† API docs âœ… NEW
â”‚   â”œâ”€â”€ PROFILE_IMPLEMENTATION.md   â† Implementation guide âœ… NEW
â”‚   â”œâ”€â”€ TESTING_PROFILE.md          â† Testing guide âœ… NEW
â”‚   â””â”€â”€ PROFILE_QUICK_REFERENCE.md  â† Quick ref âœ… NEW
â”‚
â””â”€â”€ frontend/
    â””â”€â”€ src/
        â””â”€â”€ pages/
            â”œâ”€â”€ Profile.jsx         â† Backend integrated âœ… REPLACED
            â””â”€â”€ Profile_OLD.jsx     â† Original backup
```

---

## ğŸ” Security Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Request    â”‚
â”‚ (Any Endpoint)â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   authMiddleware       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        â”‚
â”‚  1. Extract token from â”‚
â”‚     Authorization      â”‚
â”‚     header             â”‚
â”‚                        â”‚
â”‚  2. Verify JWT:        â”‚
â”‚     jwt.verify(        â”‚
â”‚       token,           â”‚
â”‚       JWT_SECRET       â”‚
â”‚     )                  â”‚
â”‚                        â”‚
â”‚  3. If valid:          â”‚
â”‚     req.user = {       â”‚
â”‚       id: decoded.id   â”‚
â”‚     }                  â”‚
â”‚     next()             â”‚
â”‚                        â”‚
â”‚  4. If invalid:        â”‚
â”‚     401 Unauthorized   â”‚
â”‚                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Controller           â”‚
â”‚                        â”‚
â”‚  â€¢ Access req.user.id  â”‚
â”‚  â€¢ Query own data only â”‚
â”‚  â€¢ No access to others'â”‚
â”‚    data                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Database Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      User       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ _id             â”‚â—„â”€â”€â”€â”€â”
â”‚ fullName        â”‚     â”‚
â”‚ email           â”‚     â”‚
â”‚ password        â”‚     â”‚
â”‚ avatar          â”‚     â”‚ reportedBy
â”‚ role            â”‚     â”‚
â”‚ preferences     â”‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
                        â”‚
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚     Hazard      â”‚     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚ _id             â”‚     â”‚
â”‚ hazardType      â”‚     â”‚
â”‚ description     â”‚     â”‚
â”‚ severity        â”‚     â”‚
â”‚ status          â”‚     â”‚
â”‚ location        â”‚     â”‚
â”‚ photo           â”‚     â”‚
â”‚ reportedBy â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”˜
â”‚ createdAt       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

When fetching user profile:
1. Get User by _id
2. Count Hazards where reportedBy = user._id
3. Group by status (Pending, Verified, Resolved)
4. Return counts as statistics
```

---

## ğŸ¯ Key Concepts

### 1. Separation of Concerns
```
Routes â†’ Controllers â†’ Models â†’ Database
  â†“          â†“           â†“
Define    Business    Data
endpoints  logic     structure
```

### 2. Middleware Chain
```
Request â†’ Auth â†’ Upload â†’ Controller â†’ Response
  â†“        â†“       â†“         â†“          â†“
Validate Verify  Save    Process    Format
headers  token   file    data       result
```

### 3. File Upload Flow
```
Client â†’ Multer â†’ Filesystem â†’ Database â†’ Response
  â†“        â†“         â†“           â†“          â†“
Select  Validate  Save file   Update     Return
file    & rename            user.avatar   URL
```

### 4. State Management (Frontend)
```
Component Mount
  â†“
useEffect()
  â†“
API Calls (fetch)
  â†“
Update State (setState)
  â†“
Re-render UI
  â†“
Display Data
```

---

This architecture provides:
- âœ… **Scalability** - Easy to add new features
- âœ… **Security** - JWT auth, validation, file checks
- âœ… **Maintainability** - Clear separation of concerns
- âœ… **Performance** - Optimized queries, efficient file handling
- âœ… **Reliability** - Error handling at every layer
